# Day 4: Introduction to Automation and Nextflow

## Overview

### Lead Instructor
- [Phelelani Mpangase](https://github.com/phelelani) |  [@???](https://twitter.com/???) | [email](mailto:Phelelani.Mpangase@wits.ac.za)

### Co-Instructor(s)
- [Scott Hazelhurst](http://dept.ee.wits.ac.za/~scott/) | [@???](https://twitter.com/???) | [email](mailto:scott.Hazelhurst@wits.ac.za)

### Helper(s)
- Maria Tsagiopoulou | [@tsayo7](https://twitter.com/tsayo7) [email](mariatsayo@gmail.com)


### General Topics

- Introduction to Nextflow
  - Use of workflow systems for automation / reproducibility
  - Basic syntax of Nextflow
  - Transform and execute a workflow in Nextflow


## Schedule

- _**09:00 - 10:00**_ Introduction to Nextflow

- _**10:00 - 11:00**_ Parameters, Channels and Processes

- _**11:00 - 11:30**_ _**Coffee break**_

- _**11:30 - 12:30**_ Docker, Executors and Channel Operations

- _**12:30 - 14:00**_ _**Lunch break**_

- _**14:00 - 15:00**_ Practical exercises in Nextflow

- _**15:00 - 16:00**_ Practical exercises in Nextflow

- _**16:00 - 16:15**_ _**Coffee break**_

- _**16:15 - 18:00**_ Practical exercises in Nextflow


## Learning Objectives

- Find and use Nextflow tool definitions online
- Understand how to write Nextflow definitions for command line tools
- Use Docker with Nextflow to provide software dependencies and ensure reproducibility
- Join Nextflow tools into a workflow
- Run Nextflow workflows on local and HPC systems


## Introduction to Automation and Nextflow

The **slides** of the talk are available [**here**]().

<H3 align="center"> Reproducible workflows using Nextflow </H3>
<p align="center">
  <img width="1000" src="_static/images/best_practices.png">
  Flow chart summarizing the resources and best practices for development, maintenance, sharing and publishing of reproducible and portable workflows.
</p>

### Our first Nexflow script
First, lets set up a directory where we will do all our Nextflow exercises:
```
mkdir $HOME/day4
cd $HOME/day4
```

Then, we download the data we will be using for the exercises:
```
wget http://www.bioinf.wits.ac.za/adme-workshop/Friday/tutorial.zip
unzip tutorial.zip
```

**Exercise 1:** You have a input file with 6 columns (see below), where column 2 is an "index" column. Identify rows that have **identical** indexes (column 2) and remove them from the file. Your input file looks like this:
```
11   11:189256   0   189256   A   G
11   11:193788   0   193788   T   C
11   11:194062   0   194062   T   C
11   11:194228   0   194228   A   G
11   11:193788   0   193788   A   C
```
Let's download our input file and have a look at it:
```
wget <>
less -S 11.bim
```

**Solution - using `bash`:**
```
cut -f 2 11.bim | sort | uniq -d > dups
grep -f dups 11.bim > 11.clean
```
This is easy to do in `bash` - very simple example, not realistic for Nextflow

**Solution - using `Nextflow`:**
```groovy
#!/usr/bin/env nexflow

input_ch = Channel.fromPath("data/11.bim")

process getIDs {
    input:
    file input from input_ch

    output:
    file "ids" into id_ch
    file "11.bim" into orig_ch
  
    script:
    "cut -f 2 $input | sort > ids"
}

process getDups {
    input:
    file input from id_ch
  
    output:
    file "dups" into dups_ch
  
    script:
    """
    uniq -d $input > dups
    touch ignore
    """
}

process removeDups {
    input:
    file badids from dups_ch
    file orig from orig_ch
    
    output:
    file "clean.bim" into output
    
    script:
    "grep -v -f $badids $orig > clean.bim "
}

output.subscribe { print "Done!" }
```


#### Exercise Material:
- [x] GitHub repository:
```
git clone http://github.com/shaze/nextflow-course
```
- [x] Exercise data:
```
wget http://www.bioinf.wits.ac.za/adme-workshop/Friday/tutorial.zip
```
